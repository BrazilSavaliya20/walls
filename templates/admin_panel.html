<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Product Management</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<style>
  /* Base Reset & Styling */
  * { box-sizing: border-box; }
  body {
    font-family: 'Inter', 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #1a202c; margin: 0; padding: 0; min-height: 100vh;
  }
  /* Container */
  .admin-container {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px; margin: 20px; padding: 32px;
    min-height: calc(100vh - 40px);
  }
  /* Header & Header Buttons */
  .header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 32px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0;
  }
  .header h1 {
    font-size: 2.5rem; font-weight: 700;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0;
  }
  .btn-home {
    background: linear-gradient(135deg, #4f46e5, #7c3aed); color: #fff; padding: 12px 24px;
    border-radius: 12px; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px;
    transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(79,70,229,0.3);
  }
  .btn-home:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(79,70,229,0.4); }

  /* Flash Messages */
  .flash { background: linear-gradient(135deg, #fef3c7, #fde68a); border: 1px solid #f59e0b; color: #92400e;
    padding: 16px; border-radius:12px; margin-bottom:24px; font-weight:500; display:flex; align-items:center; gap:12px;
    animation: slideIn 0.3s ease-out; }
  @keyframes slideIn { from {transform: translateY(-10px); opacity:0;} to {transform: translateY(0); opacity:1;} }

  /* Stats Grid */
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:16px; margin-bottom:32px; }
  .stat-card { background: linear-gradient(135deg, #f8fafc, #e2e8f0); padding:20px; border-radius:16px; border:1px solid rgba(255,255,255,0.2); text-align:center; }
  .stat-value { font-size:2rem; font-weight:700; color:#4f46e5; margin-bottom:4px; }
  .stat-label { color:#6b7280; font-size:.875rem; font-weight:500; }

  /* Product Table Container */
  .products-container { background:#fff; border-radius:20px; padding:24px; box-shadow:0 4px 20px rgba(0,0,0,0.05); margin-bottom:32px; }
  .section-header { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
  .section-header h2 { font-size:1.5rem; font-weight:600; color:#374151; margin:0; }

  /* Table Styles */
  table { width:100%; border-collapse:collapse; background:#fff; border-radius:16px; overflow:hidden; }
  thead tr { background: linear-gradient(135deg, #f8fafc, #e2e8f0); }
  th { padding:16px; font-weight:600; font-size:14px; color:#374151; border-bottom:2px solid #e5e7eb; position:sticky; top:0; z-index:10; }
  td { padding:16px; border-bottom:1px solid #f3f4f6; vertical-align:middle; }
  tbody tr:hover { background:#f8fafc; transition:background-color 0.2s ease; }

  /* Product Images */
  .product-images { display:flex; flex-wrap:wrap; gap:8px; max-width:200px; }
  .image-container { position:relative; display:inline-block; }
  .product-images img { width:60px; height:60px; object-fit:cover; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.1); transition: transform 0.2s ease; }
  .product-images img:hover { transform: scale(1.1); z-index:5; }
  .image-actions { position:absolute; top:-8px; right:-8px; display:flex; flex-direction:column; gap:4px; opacity:0; transition: opacity 0.2s ease; }
  .image-container:hover .image-actions { opacity:1; }

  /* Buttons Style */
  .btn-remove { background:#ef4444; color:#fff; border:none; border-radius:50%; width:20px; height:20px; font-size:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.2); }
  .btn-edit { background:linear-gradient(135deg,#10b981,#059669); color:#fff; border:none; border-radius:8px; padding:10px 16px; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s ease; }
  .btn-edit:hover { box-shadow:0 6px 16px rgba(16,185,129,0.4); }
  .btn-delete { background:linear-gradient(135deg,#ef4444,#dc2626); color:#fff; margin-top:8px; border:none; border-radius:8px; padding:10px 16px; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s ease; }
  .btn-delete:hover { box-shadow:0 6px 16px rgba(239,68,68,0.4); }
  .btn-add { background:linear-gradient(135deg,#2563eb,#1d4ed8); color:#fff; padding:14px 28px; font-size:16px; font-weight:600; border:none; border-radius:8px; cursor:pointer; box-shadow:0 4px 12px rgba(37,99,235,0.3); transition:all 0.2s ease; }
  .btn-add:hover { box-shadow:0 8px 20px rgba(37,99,235,0.4); }

  /* Form styles for add/update */
  .actions-cell { display:flex; flex-direction:column; gap:8px; min-width:160px; }
  .add-product-form { background:linear-gradient(135deg,#fff,#f8fafc); padding:32px; border-radius:20px; box-shadow:0 8px 25px rgba(0,0,0,0.1); border:1px solid rgba(255,255,255,0.2); margin-bottom:32px; }
  .form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-bottom:24px; }
  .form-group { display:flex; flex-direction:column; }
  .form-group label { font-weight:600; color:#374151; margin-bottom:8px; font-size:14px; }
  input[type="text"], textarea { width:100%; padding:12px; border:2px solid #e2e8f0; border-radius:8px; font-size:14px; transition:all 0.2s ease; background:#fafafa; }
  input[type="text"]:focus, textarea:focus { outline:none; border-color:#4f46e5; background:#fff; box-shadow:0 0 0 3px rgba(79,70,229,0.1); }
  input[type="file"] { display:block; margin-top:8px; }

  /* Modal styles (optional, keep or remove as needed) */
  .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); backdrop-filter:blur(5px); }
  .modal-content { background:#fff; margin:5% auto; padding:32px; border-radius:20px; width:90%; max-width:500px; box-shadow:0 20px 40px rgba(0,0,0,0.2); }

</style>
</head>
<body>

<div class="admin-container">
  <!-- Header -->
  <div class="header">
    <h1><i class="fas fa-cogs"></i> Product Management</h1>
    <a href="{{ url_for('home') }}" class="btn-home"><i class="fas fa-home"></i> Back to Store</a>
  </div>
  
  <!-- Flash Messages -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash"><i class="fas fa-info-circle"></i> {{ messages[0] }}</div>
    {% endif %}
  {% endwith %}
  
  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value">{{ products|length }}</div>
      <div class="stat-label">Total Products</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ products|selectattr('imgs')|list|length }}</div>
      <div class="stat-label">With Images</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ products|map(attribute='imgs')|map('length')|sum }}</div>
      <div class="stat-label">Total Images</div>
    </div>
  </div>
  
  <!-- Product Inventory Table -->
  <div class="products-container">
    <div class="section-header"><i class="fas fa-box"></i> <h2>Product Inventory</h2></div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th><i class="fas fa-images"></i> Images</th>
            <th><i class="fas fa-tag"></i> Product Name</th>
            <th><i class="fas fa-align-left"></i> Description</th>
            <th><i class="fas fa-dollar-sign"></i> Small</th>
            <th><i class="fas fa-dollar-sign"></i> Medium</th>
            <th><i class="fas fa-dollar-sign"></i> Large</th>
            <th><i class="fas fa-star"></i> Features</th>
            <th><i class="fas fa-tools"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>
              <div class="product-images">
                {% for url in product.imgs %}
                <div class="image-container">
                  <img src="{{ url }}" alt="{{ product.name }}" loading="lazy" onerror="this.src='/static/images/placeholder.png'" />
                  <div class="image-actions">
                    <form method="POST" class="inline-form" onsubmit="return confirm('Remove this image?');">
                      <input type="hidden" name="id" value="{{ product.id }}" />
                      <input type="hidden" name="img_url" value="{{ url }}" />
                      <input type="hidden" name="action" value="remove_image" />
                      <button type="submit" class="btn-remove" title="Remove Image"><i class="fas fa-times"></i></button>
                    </form>
                  </div>
                </div>
                {% endfor %}
              </div>
            </td>
            <!-- Product Basic Info & Edit -->
            <form method="POST" enctype="multipart/form-data" class="inline-form">
              <td class="input-wrapper">
                <input type="text" name="name" value="{{ product.name }}" required />
              </td>
              <td class="input-wrapper">
                <textarea name="desc" required>{{ product.desc }}</textarea>
              </td>
              <td class="input-wrapper">
                <input type="text" name="price_small" value="{{ product.price_small }}" required />
              </td>
              <td class="input-wrapper">
                <input type="text" name="price_medium" value="{{ product.price_medium }}" required />
              </td>
              <td class="input-wrapper">
                <input type="text" name="price_large" value="{{ product.price_large }}" required />
              </td>
              <td class="input-wrapper">
                <textarea name="features" placeholder="Comma-separated features">{{ product.features|join(', ') }}</textarea>
              </td>
              <td class="actions-cell">
                <input type="file" name="img_file" accept="image/*,.webp" multiple style="margin-bottom:8px;" />
                <input type="hidden" name="id" value="{{ product.id }}" />
                <input type="hidden" name="action" value="update" />
                <button type="submit" class="btn btn-edit"><i class="fas fa-save"></i> Save</button>
              </form>
              <form method="POST" class="inline-form" onsubmit="return confirm('Delete product?');">
                <input type="hidden" name="id" value="{{ product.id }}" />
                <input type="hidden" name="action" value="delete" />
                <button type="submit" class="btn btn-delete"><i class="fas fa-trash"></i> Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add New Product -->
  <div class="add-product-form">
    <div class="section-header"><i class="fas fa-plus-circle"></i> <h2>Add New Product</h2></div>
    <form method="POST" enctype="multipart/form-data">
      <div class="file-upload" onclick="document.getElementById('fileInput').click()" ondragover="handleDragOver(event)" ondrop="handleDrop(event)">
        <div class="file-upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
        <div class="file-upload-text">Click to upload images or drag and drop</div>
        <div class="file-upload-subtext">PNG, JPG, GIF, WEBP up to 15MB each.<br/><b>Images will be hosted securely on walls-craft.com/uploads/</b></div>
        <input type="file" id="fileInput" name="img_file" accept="image/*,.webp" multiple required style="display:none;" onchange="updateFileText(this)">
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label for="productName">Product Name</label>
          <input type="text" id="productName" name="name" placeholder="Enter product name" required />
        </div>
        <div class="form-group">
          <label for="productDesc">Description</label>
          <textarea id="productDesc" name="desc" placeholder="Product description" required></textarea>
        </div>
      </div>
      <div class="form-group">
        <label>Pricing</label>
        <div class="price-grid">
          <input type="text" name="price_small" placeholder="Small Size Price" required />
          <input type="text" name="price_medium" placeholder="Medium Size Price" required />
          <input type="text" name="price_large" placeholder="Large Size Price" required />
        </div>
      </div>
      <div class="form-group">
        <label for="productFeatures">Features</label>
        <textarea id="productFeatures" name="features" placeholder="Enter features separated by commas"></textarea>
      </div>
      <input type="hidden" name="action" value="add" />
      <button type="submit" class="btn btn-add"><i class="fas fa-plus"></i> Add Product</button>
    </form>
  </div>
</div>

<script>
  // Upload Drag & Drop
  function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('dragover'); }
  function handleDrop(e) { e.preventDefault(); e.currentTarget.classList.remove('dragover'); document.getElementById('fileInput').files=e.dataTransfer.files; updateFileText(document.getElementById('fileInput')); }
  function updateFileText(input) { document.querySelector('.file-upload .file-upload-text').textContent= input.files.length + ' file(s) selected'; }
  // Loading state on submit
  document.querySelectorAll('form').forEach(f => f.addEventListener('submit', e => {
    const btn=f.querySelector('button[type="submit"]');
    if(btn) { btn.disabled=true; btn.innerHTML='<div class="spinner"></div>'+btn.innerHTML; f.classList.add('loading'); }
  }));
</script>

<script async src="https://imgbb.com/upload.js"></script>

</body>
</html>
