<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Product Management</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f9fafb, #eef2ff);
      color: #333;
      margin: 0;
      padding: 30px;
    }
    .admin-section {
      max-width: 1200px;
      margin: auto;
    }
    h2 {
      margin-bottom: 10px;
      color: #1e293b;
      font-size: 28px;
      font-weight: 700;
    }
    h3 {
      margin: 25px 0 15px;
      color: #334155;
      font-size: 20px;
      font-weight: 600;
    }
    .top-bar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }
    .btn-home {
      background: #2563eb;
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
      transition: all 0.3s ease;
    }
    .btn-home:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }
    .flash {
      background: #ecfccb;
      border: 1px solid #84cc16;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #3f6212;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 30px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.06);
      backdrop-filter: blur(10px);
    }
    table th {
      background: #f1f5f9;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      color: #111827;
      padding: 14px;
    }
    table td {
      padding: 14px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 14px;
      vertical-align: middle;
    }
    tr:hover td {
      background: #f9fafb;
      transition: 0.3s;
    }
    .product-images {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .product-images img {
      max-width: 65px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      background: #f5f5f5;
      transition: transform 0.2s;
    }
    .product-images img:hover {
      transform: scale(1.05);
    }
    .btn {
      padding: 7px 14px;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.25s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }
    .btn-edit {
      background: #10b981;
      color: white;
    }
    .btn-edit:hover {
      background: #059669;
      transform: translateY(-2px);
    }
    .btn-delete {
      background: #ef4444;
      color: white;
    }
    .btn-delete:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }
    .btn-add {
      background: #2563eb;
      color: white;
      width: 100%;
      margin-top: 10px;
      font-size: 15px;
      font-weight: 600;
    }
    .btn-add:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }
    td.actions {
      min-width: 230px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    form.add-form {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.06);
      max-width: 500px;
      backdrop-filter: blur(12px);
      animation: fadeIn 0.4s ease;
    }
    form.add-form input,
    form.add-form textarea {
      width: 100%;
      margin-bottom: 12px;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      transition: border 0.3s;
    }
    form.add-form input:focus,
    form.add-form textarea:focus {
      outline: none;
      border: 1px solid #2563eb;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    textarea {
      resize: vertical;
      min-height: 70px;
    }
  </style>
</head>
<body>
  <div class="admin-section">
    <div class="top-bar">
      <a href="{{ url_for('home') }}" class="btn-home">üè† Home</a>
    </div>
    <h2>Admin Panel ‚Äì Product Management</h2>

    <div id="flash-box"></div>

    <h3>All Live Products</h3>
    <div id="products-table">
      {% include "products_table.html" %}
    </div>

    <h3>Add New Product</h3>
    <form id="add-form" enctype="multipart/form-data" class="add-form">
      <input type="file" name="img_file" accept="image/*" multiple required>
      <input type="text" name="name" placeholder="Product Name" required>
      <textarea name="desc" placeholder="Description" required></textarea>
      <input type="text" name="price_small" placeholder="Price Small" required>
      <input type="text" name="price_medium" placeholder="Price Medium" required>
      <input type="text" name="price_large" placeholder="Price Large" required>
      <textarea name="features" placeholder="Comma-separated features"></textarea>
      <input type="hidden" name="action" value="add">
      <button type="submit" class="btn btn-add">‚ûï Add Product</button>
    </form>
  </div>

<script>
async function handleForm(form, url="/admin") {
  const formData = new FormData(form);
  let res = await fetch(url, { method: "POST", body: formData });
  let data = await res.text();

  document.querySelector("#products-table").innerHTML = data;
  showFlash("‚úÖ Action successful!");
}

function showFlash(msg) {
  let box = document.getElementById("flash-box");
  box.innerHTML = `<div class="flash">${msg}</div>`;
  setTimeout(() => box.innerHTML = "", 3000);
}

document.getElementById("add-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  await handleForm(this);
});

document.addEventListener("submit", async function(e) {
  if (e.target.closest("#products-table form")) {
    e.preventDefault();
    await handleForm(e.target);
  }
});
</script>
</body>
</html>
